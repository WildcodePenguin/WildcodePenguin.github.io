<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>音声自動文字起こし</title>
</head>
<body>
  <h1>音声自動文字起こし</h1>
  
  <div>
    <button id="start-btn">録音開始</button>
    <button id="stop-btn" disabled>録音停止</button>
  </div>
  
  <div>
    <h2>文字起こし結果</h2>
    <p id="transcript"></p>
  </div>

  <script>
    let recognition;
    const startBtn = document.getElementById('start-btn');
    const stopBtn = document.getElementById('stop-btn');
    const transcript = document.getElementById('transcript');

    // 録音開始ボタンがクリックされたときの処理
    startBtn.addEventListener('click', () => {
      // 録音APIのサポートをチェック
      if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
        transcript.textContent = 'このブラウザは音声認識をサポートしていません。';
        return;
      }
      
      // 録音APIのインスタンスを作成
      recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();

      // 認識中に逐次結果を取得するように設定
      recognition.interimResults = true;
      
      // 認識開始イベント
      recognition.onstart = () => {
        startBtn.disabled = true;
        stopBtn.disabled = false;
        transcript.textContent = '音声認識中...';
      };
      
      // 認識結果イベント
      recognition.onresult = (event) => {
        let interimTranscript = '';
        let finalTranscript = '';
        
        // 認識結果を取得
        for (let i = event.resultIndex; i < event.results.length; i++) {
          const transcript = event.results[i][0].transcript;
          
          // 逐次結果と確定結果に分ける
          if (event.results[i].isFinal) {
            finalTranscript += transcript;
          } else {
            interimTranscript += transcript;
          }
        }
        
        // 逐次結果を表示
        transcript.textContent = interimTranscript;
      };
      
      // 録音停止イベント
      recognition.onend = () => {
        startBtn.disabled = false;
        stopBtn.disabled = true;
        transcript.textContent = '音声認識終了。';
      };
      
      // 録音開始
      recognition.start();
    });

    // 録音停止ボタンがクリックされたときの処理
    stopBtn.addEventListener('click', () => {
      // 録音停止
      recognition.stop();
    });
  </script>
</body>
</html>
