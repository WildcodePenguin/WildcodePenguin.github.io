<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ãƒãƒ«ã‚³ãƒ•é€£é–ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <style>
    #outputText {
      white-space: pre-wrap;
      width: 100%;
      color: rgb(99, 65, 132);
    }
  </style>
</head>
<body>
  <textarea id="inputText" rows="10" cols="50"></textarea><br>
  <input type="radio" name="chainType" value="normal" checked="checked" onchange="updateChainType()">é€šå¸¸ã®ãƒãƒ«ã‚³ãƒ•é€£é–
  <input type="radio" name="chainType" value="twoWords" onchange="updateChainType()">2ã¤å‰ã‚‚å«ã‚ãŸãƒãƒ«ã‚³ãƒ•é€£é–<BR>
  çŸ­ã‚<input type="range" id="charLimit" min="10" max="10000000" value="5000000" step="10" onchange="updateCharLimit()">
  <label for="charLimit"> <span id="charLimitValue" style="display: none;">5000000</span></label>  é•·ã‚ã€€
  ç”Ÿæˆã—ãŸæ–‡å­—æ•°ï¼š<output id="len">0</output>æ–‡å­—ã€€<br>å…ƒãƒ‡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹ç”Ÿæˆãƒ‡ãƒ¼ã‚¿ã®å‰²åˆï¼š<output id="lenp">0</output>ï¼…ã€€æ¨å®šåŸç¨¿ç”¨ç´™æšæ•° ï¼š<output id="lenprint">0</output>æš<br>
  <button onclick="generateText()">ç”Ÿæˆ</button>
  <button onclick="speakText()">éŸ³å£°èª­ã¿ä¸Šã’</button><bR>ğŸ”ƒæ¯å›ã€å›ç­”ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚æ–‡æ³•çš„ãªã“ã¨ã¯è€ƒæ…®ã—ã¦ã„ã¾ã›ã‚“ã€‚<BR>ChatGPTãªã©ã«æ·»å‰Šã‚’ä¾é ¼ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚
  <div id="outputText"></div>

  <script>
    var currentCharIndex = 0;
    var generatedText = "";
    var chainType = "normal"; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯é€šå¸¸ã®ãƒãƒ«ã‚³ãƒ•é€£é–

function updateChainType() {
  var chainTypeElements = document.getElementsByName("chainType");

  for (var i = 0; i < chainTypeElements.length; i++) {
    if (chainTypeElements[i].checked) {
      chainType = chainTypeElements[i].value;
      break;
    }
  }
}

    function updateCharLimit() {
     var charLimitValue = document.getElementById("charLimit").value;
     document.getElementById("charLimitValue").textContent = charLimitValue;
    }

    function resetOutputText() {
      var outputText = document.getElementById("outputText");
      outputText.textContent = "";
    }
function generateText() {
  var inputText = $("#inputText").val();
  // var wordLimit = document.getElementById("wordLimit").value;
  var charLimit = document.getElementById("charLimit").value;

  var markovChain;
  if (chainType === "normal") {
    markovChain = buildMarkovChain(inputText);
  } else if (chainType === "twoWords") {
    markovChain = buildTwoWordsMarkovChain(inputText);
  }

  generatedText = generateSentence(markovChain,charLimit);
  currentCharIndex = 0;

  resetOutputText(); // è¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’ãƒªã‚»ãƒƒãƒˆ
  displayNextCharacter(); // æœ€åˆã®æ–‡å­—ã‚’è¡¨ç¤º
}

function buildTwoWordsMarkovChain(inputText) {
  var words = inputText.split(/[ \n]+/);
  var markovChain = {};

  for (var i = 0; i < words.length - 2; i++) {
    var currentWord = words[i];
    var nextWord = words[i + 1];
    var twoWordsKey = currentWord + " " + nextWord;

    if (!markovChain[twoWordsKey]) {
      markovChain[twoWordsKey] = [];
    }

    markovChain[twoWordsKey].push(words[i + 2]);
  }

  return markovChain;
}




    function displayNextCharacter() {
      if (currentCharIndex < generatedText.length) {
        var nextChar = generatedText.charAt(currentCharIndex);
        var outputText = document.getElementById("outputText");
        if (nextChar === " ") {
          outputText.innerHTML += "<br>"; // æ”¹è¡Œã‚¿ã‚°ã‚’è¿½åŠ 
        } else {
          outputText.textContent += nextChar;
        }
        currentCharIndex++;
        document.getElementById("len").value = currentCharIndex;
        var originalText = document.getElementById("inputText").value;
        // var generatedText = "ç”Ÿæˆã•ã‚ŒãŸæ–‡å­—åˆ—";
        var originalLength = originalText.length;
        var generatedLength = currentCharIndex;
        if (currentCharIndex) {
          var ratio = (generatedLength / originalLength) * 100;
          document.getElementById("lenp").value = floorDecimal(ratio, 2);
          document.getElementById("lenprint").value =  floorDecimal(generatedLength/400, 2);
          console.log("ç”Ÿæˆã•ã‚ŒãŸæ–‡å­—åˆ—ã¯å…ƒã®æ–‡å­—åˆ—ã® " + ratio + "% ã®é•·ã•ã§ã™ã€‚");
        }
          setTimeout(displayNextCharacter, 0.001); // 100ãƒŸãƒªç§’ã”ã¨ã«æ¬¡ã®æ–‡å­—ã‚’è¡¨ç¤º
      }
    }

function buildMarkovChain(inputText) {
  var words = inputText.split(/[ \n]+/);
  var markovChain = {};

  if (chainType === "normal") {
    for (var i = 0; i < words.length - 1; i++) {
      var currentWord = words[i];

      if (!markovChain[currentWord]) {
        markovChain[currentWord] = [];
      }

      markovChain[currentWord].push(words[i + 1]);
    }
  } else if (chainType === "twoWords") {
    for (var i = 0; i < words.length - 2; i++) {
      var currentWord = words[i];
      var nextWord = words[i + 1];
      var twoWordsKey = currentWord + " " + nextWord;

      if (!markovChain[twoWordsKey]) {
        markovChain[twoWordsKey] = [];
      }

      markovChain[twoWordsKey].push(words[i + 2]);
    }
  }

  return markovChain;
}


function generateSentence(markovChain, wordLimit) {
      var words = Object.keys(markovChain);
      var startIndex = Math.floor(Math.random() * words.length);
      var currentWord = words[startIndex];
      var sentence = currentWord;

      for (var i = 0; i < wordLimit - 1; i++) {
        if (markovChain[currentWord]) {
          var nextWordIndex = Math.floor(Math.random() * markovChain[currentWord].length);
          var nextWord = markovChain[currentWord][nextWordIndex];
          sentence += " " + nextWord;
          currentWord = nextWord;
        } else {
          break;
        }
      }

      return sentence;
    }

function speakText() {
      var inputText = document.getElementById("outputText").textContent;

      if ('speechSynthesis' in window) {
        alert("éŸ³å£°èª­ã¿ä¸Šã’ã‚’é–‹å§‹ã—ã¦ã„ã¾ã™...")
        var speechSynthesis = window.speechSynthesis;
        var utterance = new SpeechSynthesisUtterance(inputText);
        speechSynthesis.speak(utterance);
      } else {
        alert('Web Speech APIã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
      }
    }

// åˆ‡ã‚Šæ¨ã¦
function floorDecimal(value, n) {
  return Math.floor(value * Math.pow(10, n) ) / Math.pow(10, n);
}
 
// åˆ‡ã‚Šä¸Šã’
function ceilDecimal(value, n) {
  return Math.ceil(value * Math.pow(10, n) ) / Math.pow(10, n);
}
 
// å››æ¨äº”å…¥
function roundDecimal(value, n) {
  return Math.round(value * Math.pow(10, n) ) / Math.pow(10, n);
}
  </script>
</body>
</html>
